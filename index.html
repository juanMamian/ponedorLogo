<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Image Watermarker</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
	<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-50">
	<div id="app">
		<div class="p-4 max-w-lg mx-auto space-y-6">
			<h1 class="text-2xl font-bold text-center mb-6">Image Watermarker</h1>

			<div class="space-y-4">
				<!-- Photo Upload -->
				<div class="grid gap-4">
					<label class="block">
						<div class="flex items-center gap-2 mb-2">
							<span>Upload Photo</span>
						</div>
						<input type="file" accept="image/*"
							@change="(e) => handleImageUpload(e, 'image')"
							class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
					</label>

					<!-- Logo Upload -->
					<label class="block">
						<div class="flex items-center gap-2 mb-2">
							<span>Upload Logo</span>
						</div>
						<input type="file" accept="image/*"
							@change="(e) => handleImageUpload(e, 'logo')"
							class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
					</label>
				</div>

				<!-- Opacity Slider -->
				<div>
					<label class="block mb-2">Logo Opacity: {{ opacity }}</label>
					<input type="range" min="0" max="1" step="0.1" v-model="opacity"
						class="w-full" />
				</div>

				<!-- Alert -->
				<div v-if="!hasImage || !hasLogo"
					class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
					<div class="flex items-center gap-2 text-yellow-800">
						<p>Please upload both a photo and a logo to start</p>
					</div>
				</div>

				<!-- Canvas -->
				<canvas ref="canvas" class="w-full h-auto border rounded-lg"></canvas>

				<!-- Download Button -->
				<button v-if="hasImage && hasLogo" @click="downloadImage"
					class="w-full flex items-center justify-center gap-2 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
					Download Watermarked Image
				</button>
			</div>
		</div>
	</div>

	<script>
		const {createApp, ref, watch} = Vue

		createApp({
			setup() {
				const hasImage = ref(false)
				const hasLogo = ref(false)
				const opacity = ref(0.7)
				const canvas = ref(null)
				let mainImage = null
				let logoImage = null

				const handleImageUpload = (e, type) => {
					const file = e.target.files[0]
					if (file) {
						const reader = new FileReader()
						reader.onload = (event) => {
							const img = new Image()
							img.onload = () => {
								if (type === 'image') {
									mainImage = img
									hasImage.value = true
								} else {
									logoImage = img
									hasLogo.value = true
								}
								processImage()
							}
							img.src = event.target.result
						}
						reader.readAsDataURL(file)
					}
				}

				const processImage = () => {
					if (!mainImage || !logoImage || !canvas.value) return

					const ctx = canvas.value.getContext('2d')

					// Set canvas size to match uploaded image
					canvas.value.width = mainImage.width
					canvas.value.height = mainImage.height

					// Draw main image
					ctx.drawImage(mainImage, 0, 0)

					// Calculate logo size (20% of image width)
					const logoWidth = mainImage.width * 0.2
					const logoHeight = (logoImage.height * logoWidth) / logoImage.width

					// Set logo opacity
					ctx.globalAlpha = opacity.value

					// Draw logo in bottom right corner with padding
					const padding = 20
					ctx.drawImage(
						logoImage,
						canvas.value.width - logoWidth - padding,
						canvas.value.height - logoHeight - padding,
						logoWidth,
						logoHeight
					)

					// Reset opacity
					ctx.globalAlpha = 1
				}

				const downloadImage = () => {
					if (!canvas.value) return

					const link = document.createElement('a')
					link.download = 'watermarked-image.png'
					link.href = canvas.value.toDataURL('image/png')
					link.click()
				}

				watch(opacity, () => {
					if (hasImage.value && hasLogo.value) {
						processImage()
					}
				})

				return {
					hasImage,
					hasLogo,
					opacity,
					canvas,
					handleImageUpload,
					downloadImage
				}
			}
		}).mount('#app')
	</script>
</body>

</html>
